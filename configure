#!/bin/bash
#
# FileName: configure
# Description: Config script script that runs cmake, builds and installs qmicad.
# 
# Copyright (C) 2014  K M Masum Habib <masum.habib@gmail.com>
#
# Created: 18 June 2014.

function usage(){
    echo "Usage: configure [options]"
    echo "  When no option is given, configures qmicad using cmake."
    echo "  options: " 
    echo "    build [clean]: builds qmicad using make."
    echo "    superclean: deletes build folder."
    echo "    install [path]: installs qmicad."
}

function doconfig(){
    mkdir -p build
    cd build
    cmake28 ../
}

ncpu="4"
if [[ $# -eq 0 ]]; then
    # No argument, run cmake
    doconfig
elif [[ $# -ge 1 ]]; then
    opt=$1
    if [[ $opt == "help" ]]; then
        usage
    elif [[ $opt == "build" ]]; then
        if [[ ! -d "build/" ]]; then
            doconfig
            cd ../
        fi

        if [[ $# == 2 ]]; then
            mkopt=$2
            cd build && make -j $ncpu $mkopt
        else
            cd build && make -j $ncpu
        fi
    elif [[ $opt == "superclean" ]]; then
        rm -rf build
    elif [[ $opt == "install" ]]; then
        if [[ $# == 2 ]]; then
            install_dir=$2
            cd build && make install DESTDIR=$install_dir 
        else
            cd build && make install 
        fi
    else
        usage
        exit -1
    fi
else
    usage
    exit -1
fi


